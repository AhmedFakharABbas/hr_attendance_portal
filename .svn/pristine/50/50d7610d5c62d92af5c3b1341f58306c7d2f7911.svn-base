import { Component, OnInit, Input } from "@angular/core";
import { FormControl, FormGroup, Validators } from "@angular/forms";
import { GrievanceService } from "../grievance.service";
@Component({
  selector: "app-grievance-form",
  templateUrl: "./grievance-form.component.html",
  styleUrls: ["./grievance-form.component.css"],
})
export class GrievanceFormComponent implements OnInit {
  @Input() applicationType;
  grievanceForm: any;
  allDepartments: any;
  allDesignations: any;
  constructor(private _grievanceService: GrievanceService) {}

  ngOnInit(): void {
    this.applicationType.ComponenttypeId;
    this.loadGrievanceForm();
    console.log(this.applicationType);
    this.onGetMetaData();
  }
  LoadMet;
  // load form
  loadGrievanceForm() {
    this.grievanceForm = new FormGroup({
      employee_name: new FormControl("", Validators.required),
      grievanceAgainstId: new FormControl("", Validators.required),
      department_id: new FormControl("", Validators.required),
      designation_id: new FormControl("", Validators.required),
      targetTypeId: new FormControl("", Validators.required),
      againstDepartment: new FormControl("", Validators.required),
      againstDesignation: new FormControl("", Validators.required),
      from: new FormControl(""),
      to: new FormControl(""),
    });
  }
  // on submit
  onSubmit() {
    console.log("submit trigger ");
    console.log(this.grievanceForm.value);
  }
  // file upload
  fileUpload(event) {
    console.log(event.target.files);
    console.log(event);
  }
  //Get meta data
  onGetMetaData() {
    //get employee form section start

    if (this.applicationType.type == "Emp-portal") {
      this.getEmpFormData("/get_emp_portal_meta_data");


    }

  }
  getEmpFormData(url) {
    //to get data for  emp portal form
    this._grievanceService.getData(url).subscribe({
      next: (res: any) => {
        console.log(res);
        let serverData = res[0];
        this.allDepartments = serverData.Departments;
        this.allDesignations = serverData.Designation;
        this.grievanceForm.patchValue(serverData.employee);
      },
      error: (error) => {
        console.log(error);
      },
    });
  }

}
